<title>Ecosystem Infra rotation</title>
<p>See <a href="https://bit.ly/ecosystem-infra-rotation">bit.ly/ecosystem-infra-rotation</a>
for full rotation instructions.
<p>web-platform-tests triage:
<ul></ul>
<script>
const ul = document.querySelector('ul');

function daysAgo(days) {
  const date = new Date(Date.now() - days * 24 * 3600 * 1000);
  return date.toISOString().substr(0, 10);
}

const queries = [
  { desc: 'pending export PRs', q: 'is:pr is:open label:chromium-export -label:"do not merge yet"' },
  { desc: 'untriaged issues', q: 'is:issue is:open label:infra -label:priority:backlog -label:priority:roadmap -label:priority:urgent' },
  { desc: 'urgent issues >2 days', q: `is:issue is:open label:infra label:priority:urgent updated:<${daysAgo(2)} sort:updated-asc` },
  { desc: 'roadmap issues >60 days', q: `is:issue is:open label:infra label:priority:roadmap updated:<${daysAgo(60)} sort:updated-asc` },
];

// These two URLs for the API and the website should be in sync, different views of the same data.
const API_BASE_URL = "https://api.github.com/search/issues?q=repo%3Aw3c%2Fweb-platform-tests%20";
const WEB_BASE_URL = "https://github.com/w3c/web-platform-tests/issues?q=";

for (const query of queries) {
  // Insert the web URL.
  const webUrl = WEB_BASE_URL + encodeURIComponent(query.q);
  const a = document.createElement('a');
  a.href = webUrl;
  a.textContent = query.desc;
  const li = document.createElement('li');
  li.appendChild(a);
  ul.appendChild(li);

  // Hit the API and update the page with the number of results.
  const apiUrl = API_BASE_URL + encodeURIComponent(query.q);
  fetch(apiUrl)
    .then(r => r.json())
    .then(results => {
      li.appendChild(document.createTextNode(` (${results.total_count})`));
    });
}
</script>
